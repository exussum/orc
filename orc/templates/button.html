{% extends 'base.html' %}

{% block body %}
    <div class="orc-room-buttons">
    {% for id in room_configs %}
        <div>{{ id }}</div>
        <div class="orc-button">
            <button class="btn btn-primary orc-runner" data-state="on" data-type="room" data-id="{{ id }}"><i class="bi bi-lightbulb-fill"></i></button>
        </div>
        <div class="orc-button">
            <button class="btn btn-primary orc-runner" data-state="off" data-type="room" data-id="{{ id }}"><i class="bi bi-lightbulb-off"></i></button>
        </div>
        <div class="orc-button">
            <button class="btn btn-primary orc-runner" data-state="follow" data-type="room" data-id="{{ id }}"><i class="bi bi-geo"></i></button>
        </div>
    {% endfor %}
    </div>
    <hr class="hr orc-hr"/>
    <div>
        <div><b>Theme</b></div>
        <div class="orc-routine-buttons">
        {% for id in theme_configs %}
            <div class="orc-button">
                <div class="orc-button-label">{{ id }}</div>
                <button class="btn btn-primary orc-runner" data-type="console" data-id="{{ id }}"><i class="bi bi-clipboard-check"></i></button>
            </div>
        {% endfor %}
        </div>
    </div>
    <hr class="hr orc-hr"/>
    <div>
        <div><b>Super Routine</b></div>
        <div class="orc-routine-buttons">
        {% for id in other_configs %}
            <div class="orc-button">
                <div class="orc-button-label">{{ id }}</div>
                <button class="btn btn-primary orc-runner" data-type="console" data-id="{{ id }}"><i class="bi bi-rocket-takeoff"></i></button>
            </div>
        {% endfor %}
        </div>
    <hr class="hr orc-hr"/>
    <div class="orc-power-user">
        <div class="orc-routine-buttons orc-overflow">
            <div>
                <div class="btn-group dropup">
                    <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Routines</button>

                    <div class="dropdown-menu">
                    {% for id in schedule_routines %}
                        <a class="dropdown-item orc-runner" href="#" data-type="console" data-id="{{id}}">{{id}}</a>
                    {% endfor %}
                    </div>
                </div>
            </div>
            {% if next_routine %}
                <div class="orc-button-next">
                    <div>
                        <div><b>{{ next_routine.name }}</b></div>
                        <div>Coming up at {{ next_routine.trigger.run_date.time().strftime("%I:%M %p") }}</div>
                        </div>
                    <button class="btn btn-primary orc-pause" data-type="console" data-id="{{ next_routine.id }}">Skip</i></button>
                </div>
            {% endif %}
        </div>
    </div>
{% endblock %}

{% block tail %}
    <script>
        async function run(el) {
            await call(`/api/${el.dataset.type}/${el.dataset.id}?state=${el.dataset.state}`, el);
        }

        const expertRoutines = ["Test", "Restore Snapshot", "Video Conference"];
        const isPowerUser = localStorage.getItem("isPowerUser");

        document.querySelectorAll(".orc-runner").forEach(el => { 
            el.addEventListener("click", e => { 
                run(e.currentTarget); 
            })
        });

        document.querySelector(".orc-pause").addEventListener("click", e => {
            call(`/api/schedule/${e.currentTarget.getAttribute("data-id")}/pause`, e.currentTarget).then(() => { location.reload() } );
        });

        document.querySelectorAll(".orc-button").forEach(el => {
            let dataSelector = el.querySelector(".orc-runner");
            if(isPowerUser !== "true" && expertRoutines.includes(dataSelector.getAttribute("data-id"))) {
                el.classList.add("orc-input-filtered");
            }
        });

    </script>
{% endblock %}
