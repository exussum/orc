{% extends 'admin/master.html' %}

{% block head_css %}
    {{ super() }}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    <style>
        hr.orc-hr {
            border: revert;
        }

        div.orc-theme-buttoms {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
        }
        div.orc-room-buttoms {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
        }
 
        div.orc-button {
            width: 100px;
            margin-bottom: 20px;
            text-align: center;
        }
        div.orc-button-label {
            height: 3em;
            display: flex;
            flex-flow: column-reverse;
        }
    </style>
{% endblock %}

{% block body %}
    <div class="orc-room-buttoms">
    {% for id in room_configs %}
        <div>{{ id }}</div>
        <div class="orc-button">
            <button class="btn btn-primary orc-runner" data-state="on" data-type="room" data-id="{{ id }}"><i class="bi bi-lightbulb-fill"></i></button>
        </div>
        <div class="orc-button">
            <button class="btn btn-primary orc-runner" data-state="off" data-type="room" data-id="{{ id }}"><i class="bi bi-lightbulb-off"></i></button>
        </div>
        <div class="orc-button">
            <button class="btn btn-primary orc-runner" data-state="follow" data-type="room" data-id="{{ id }}"><i class="bi bi-person-walking"></i></button>
        </div>
    {% endfor %}
    </div>
    <hr class="hr orc-hr"/>
    <div class="orc-theme-buttoms">
    {% for id in theme_configs %}
        <div class="orc-button">
            <div class="orc-button-label">{{ id }}</div>
            <button class="btn btn-primary orc-runner" data-type="console" data-id="{{ id }}"><i class="bi bi-clipboard-check"></i></button>
        </div>
    {% endfor %}
    </div>
    <hr class="hr orc-hr"/>
    <div class="orc-theme-buttoms">
    {% for id in other_configs %}
        <div class="orc-button">
            <div class="orc-button-label">{{ id }}</div>
            <button class="btn btn-primary orc-runner" data-type="console" data-id="{{ id }}"><i class="bi bi-rocket-takeoff"></i></button>
        </div>
    {% endfor %}
    </div>

{% endblock %}

{% block tail %}
    <script>
        async function run(el) {
            el.disabled = true;
            let response = null;

            try {
                response = await fetch(`/${el.dataset.type}/${el.dataset.id}?state=${el.dataset.state}`);
                if (!response.ok) {
                    throw Error(`Response status: ${response.status}`);
                }
                return true;
            } catch (error) {
                console.error(error.message);
            } finally {
                el.disabled = false;
            }
        }
        document.querySelectorAll(".orc-runner").forEach(el => { el.addEventListener("click", e => run(e.currentTarget)); });
    </script>
{% endblock %}
